<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Lit.dev v2 form Local</title>
</head>
<body>

<form-login></form-login>

<script type="module">
import {html, LitElement} from "./lit.dev-v2/lit-bundle.js"

export class FormLogin extends LitElement {

  static properties = {
    _list: {type: Array, state:true},
    _code: {type: String, state: true},
    _description: {type: String, state: true},
  }

  constructor() {
    super();
    this._list = []
    this._code = ""
    this._description = ""
  }

  submitForm(e) {
    e.preventDefault();
    const form = this.shadowRoot.querySelector("form");
    console.log(e.target, form); // successfully logs <form> element
    window.setTimeout(() => {
      console.log(form); // successfully logs <form> element
      form.reset(); // resets form
    }, 2000);
  }

  async loadData() {
    const url = "https://json.theframework.es/index.php?getfile=app_product.json"
    const r = await (await fetch(url)).json()
    this._list = r
  }

  loadInfo(){
    const product = this._list[0] ?? null
    if(product) {
      this._code = product.code_erp
      this._description = product.description
    }
  }

  render() {
    return html`
    <form @submit=${this.submitForm}>
      <div class="form-controls">
        <div>
          <label for="code">code</label>
          <input type="text" id="code" name="code" .value=${this._code} />
        </div>
        
        <div>
          <label for="description">Address</label>
          <input type="text" id="description" name="description" .value=${this._description} />
        </div>

        <button type="button" @click=${this.loadInfo}>load info</button>
      </div>
    </form>
    <hr/>
    <div>
      <button type="button" @click=${this.loadData()} >load data</button>
      <table>
        <thead>
          <tr>
            <th>id</th><th>code</th><th>description</th><th>price</th>
          </tr>
        </thead>
        <tbody>
          ${this._list.length > 0
            ? this._list.map(
                product => html`<tr><td>${product.id}</td><td>${product.code_erp}</td><td>${product.description}</td><td>${product.price_regular}</td></tr>`
            )
            : html `<b>no data loaded</b>`
          }
        </tbody
      </table>
    </div>
    `;
  }
}

customElements.define("form-login", FormLogin);
</script>
</body>
</html>